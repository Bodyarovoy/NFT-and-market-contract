есть список сминченых нфт в которых есть id
создатель коллекции

Запустить лотерею


Struct lottery{
id: LotteryId,
lottery_token_id: AccountId,
lottery_status: LotteryStatus,
entries: Vec<AccountId>, //AccountId from nft-contract - series.rs - nft_mint
winner: Option<AccountId>, 
message_for_winner: String,
}



fn new

   fn get_accounts_num(&self) -> u32 {
self.entries.len() as _
}



fn is_finished(&self) -> bool {
    self.lottery_status == LotteryStatus::Finished && self.is_pools_equal() && self.winner.is_some()
}

pub fn assert_is_finished(&self) {
self.assert_equals_pool();
assert!(self.winner.is_some());
} 

fn set_winner(&mut self) {
    let total_entries = self.get_accounts_num();
    let index = get_range_random_number(0, total_entries);
    let winner = &self.entries[index];
   
    self.winner = Some(winner.clone());
}


pub fn get_winner_unwrap(&self) -> AccountId {
    match &self.winner {
        Some(winner) => winner.clone(),
        None => panic!("Lottery has no winner"),
}
}

Владелец коллекции запускает лоттерею
При минте нтф, те кто минтят автоматически становятся участниками
Когда набирается необходимое количество участников проходит розыгрыш
Владелец коллекции получает результаты лотереи

Для владельца коллекции
pub fn new_lottery (lib.rs -> pub fn new) - делает кросс контракный вызов в lottery pub fn new

Проверяет, что создатель лотереи - это создатель коллекции
Можно выбрать количевстко участников
Должен принимать результат лотереи

near call $CONTRACT new '{
    "config": {
        "owner_id": "'$OWNER'", - владелец коллекции
        "contract_fee_ratio": 0,
        "treasury_ratio": 0,
        "investor_ratio": 0,
        "treasury": "'$TREASURY'", - контракт коллекции
        "investor": "'$INVESTOR'", - контракт коллекции
        "accepted_subs": "'$ACCEPTED_SUBS'" - номер нфт.котракт коллекции.тестнет
    },
    "entry_fees": [
        ["near", [
            "'$0.1_NEAR'"           
        ]]
    ],
    "num_participants": [
        5,6,7,8,9,10
    ]
}' --accountId $CONTRACT


Для покупателей нфт:
Создаётся субакаунт контракта с минтом с балансои 0.2 нир
Автоматически выполняется
pub fn draw_near_enter (lottery.rs -> pub fn draw_near_enter) - делает кросс контракный вызов в lottery pub fn draw_near_enter


near call $CONTRACT draw_near_enter '{
    "lottery_type": "SIMPLE_LOTTERY",
    "num_participants": 5, - число участников которое указал владелец коллекции при создании контракта
    "entry_fee": "'$0.1_NEAR'"
}' --accountId $номер нфт.котракт коллекции.тестнет --depositYocto=$0.1_NEAR --gas=$GAS



Константа газ
Константа нир депозит
добавить в енв

промис - добавить в енв

промис резалт - добавить в енв
[ext_contract(contract_lottery)]
pub train LotteryContract{
    fn new () ->
}

contract_lottery_adress(&self) -> String {
    "адресс конгтракта".to_string()
}

pub fn start_new_lottery(&self) -> Promise {
    contract_lottery::new(&self.contract_lottery_adress(), аргументы)

}